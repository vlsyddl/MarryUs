<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.marryus.repository.mapper.MypageMapper">
	<resultMap id="comInfoMap" type="CompanyInfo">
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="memNo"   column="mem_no"/>
        <result  property="comInfoContent"   column="com_info_content"/>
		<result  property="comInfoProfile"   column="com_info_profile"/>
		<result  property="comInfoName"   column="com_info_name"/>
		<result  property="comInfoPhone"   column="com_info_phone"/>
		<result  property="comInfoAddr"   column="com_info_addr"/>
		<result  property="comInfoAddrDetail"   column="com_info_addr_detail"/>
		<result  property="comInfoType"   column="com_info_type"/>
		<result  property="comInfoOkay"   column="com_info_okay"/>
		<result  property="comFileName"   column="com_file_name"/>
		<result  property="comFilePath"   column="com_file_path"/>
	</resultMap>
	
	

	
	
	<resultMap id="comFileMap" type="CompanyFile">
		<result  property="comFileNo"   column="com_file_no"/>
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="comFileName"   column="com_file_name"/>
		<result  property="comFileOriname"   column="com_file_oriname"/>
		<result  property="comFilePath"   column="com_file_path"/>
	</resultMap>
	
	
	<resultMap id="tenderMap" type="Tender">
		<result property="tenderNo" column="tender_no" />
		<result property="auctionNo" column="action_no" />
		<result property="tenderStatus" column="tender_status" />
		<result property="tenderBudget" column="tender_budget" />
		<result property="tenderRegdate" column="tender_regdate" />
        <result property="genName" column="gen_name" />
	</resultMap>
	
	<resultMap id="auctionMap" type="Auction">
		<result property="auctionNo" column="auction_no" />
		<result property="memNo" column="mem_no" />
		<result property="comNo" column="com_no" />
		<result property="auctionType" column="auction_type" />
		<result property="auctionStatus" column="auction_status" />
		<result property="auctionSdate" column="auction_sdate" />
		<result property="auctionEDate" column="auction_edate" />
		<result property="genName" column="gen_name" />
	</resultMap>
	
	
	
	
	
	<resultMap id="generalMemberMap" type="GeneralMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="memStatus" column="mem_status" />
		<result property="memName" column="mem_name" />
		<result property="memPhone" column="mem_phone" />
		<result property="birth" column="birth" />
		<result property="genGender" column="gen_gender" />
	</resultMap>
	
	
	
	<resultMap id="companyMemberMap" type="CompanyMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="memName" column="mem_name" />
		<result property="comAddr" column="com_addr" />
		<result property="comAddrDetail" column="com_addr_detail" />
		<result property="memPhone" column="mem_phone" />
		<result property="comType" column="com_type" />
		<result property="comOkay" column="com_okay" />
	</resultMap>
	
	
	
	<select id="selectTenderList" parameterType="int" resultMap="tenderMap"  >
	select *
	from mu_tender 
	where auction_no=#{auctionNo}

	</select>
	
	


	
	

	
	<!-- 업체 정보 등록, 수정, 삭제시 사용 -->
	<select id="selectComInfoList"  parameterType="int" resultMap="comInfoMap">
		select *
		from mu_company_info ci right join mu_company_file cf
        on ci.com_info_no = cf.com_info_no
        where ci.mem_no=#{memNo}
        and cf.com_file_repr = 'Y'
	</select>
	
	
	<select id="selectComInfoDetail" parameterType="int" resultMap="comInfoMap">
		select *
		from mu_company_info ci right join mu_company_file cf
        on ci.com_info_no = cf.com_info_no
        where ci.com_info_no=#{comInfoNo}
	</select>
	
	
	<insert id="insertComInfo" parameterType="CompanyInfo"  >
	    <selectKey resultType="int" keyProperty="comInfoNo" order="BEFORE">
            SELECT MAX(com_info_no)+1 FROM     mu_company_info 
        </selectKey>    
	
		insert into mu_company_info(mem_no, com_info_content, com_info_profile, com_info_name, com_info_phone,com_info_addr, com_info_addr_detail, com_info_type) 
        values(#{memNo}, #{comInfoContent}, #{comInfoProfile}, #{comInfoName}, #{comInfoPhone},#{comInfoAddr}, #{comInfoAddrDetail}, #{comInfoType})

	</insert>
	
	<update id="updateComInfo" parameterType="CompanyInfo">
		update mu_comany_info 
        set com_info_content = #{comInfoContent},
		com_info_profile = #{comInfoProfile}
		com_info_name=#{comInfoName},
		com_info_phone=#{comInfoPhone},
		com_info_addr=#{comInfoAddr},
		com_info_addr_detail=#{comInfoAddrDetail},
		com_info_type=#{comInfoType},
		com_info_okay=#{comInfoOkay}
		where com_info_no=#{comInfoNo} 
	</update>
	
	<delete id="deleteComInfo" parameterType="int">
		delete from mu_comany_info 
		where com_info_no=#{comInfoNo}
	</delete>
	
	<!-- 업체 정보  파일 등록, 수정, 삭제시 사용 -->
	
	
	<select id="selectComFileDetail" parameterType="int" resultMap="comInfoMap">
		select *
		from mu_company_file
		where com_info_no=#{comInfoNo}
	</select>
	
	
	<insert id="insertComFile" parameterType="CompanyFile">
		insert into mu_company_file(com_info_no, com_file_name, com_file_oriname, com_file_path)
		values(#{comInfoNo}, #{comFileName}, #{comFileOriname}, #{comFilePath})
	</insert>
	
	<update id="updateComFile" parameterType="CompanyFile">
		update mu_comany_file
		set com_info_no=#{comInfoNo},
		com_file_name=#{comFileName},
		com_file_path=#{comFilePath}
		where com_info_no=#{comInfoNo}
	</update>
	
	<delete id="deleteComFile" parameterType="int">
		delete from mu_comany_file 
		where com_info_no=#{comInfoNo}
	</delete>
	
	
	<!-- 관리자 경매리스트 -->

    <select id="selectAuction"  parameterType="Page" resultMap="tenderMap">
        SELECT tender_regdate, gen_name, tender_status, tender_budget 
        FROM (select * 
        from mu_auction a, mu_general g
        where a.mem_no = g.gen_no) as aa
        RIGHT JOIN mu_tender t
        ON aa.auction_no = t.auction_no
        and  aa.com_no=#{comNo}
        limit #{begin}, 10
	</select>




	
	
    <select id="selectAuctionCnt" parameterType="int" resultType="int">
		select count(*) as count
        from(select t.tender_no 
        from mu_auction a, mu_tender t
        where a.auction_no = t.auction_no
        and com_no=#{comNo}) a
	</select>
	
	
	
	
	<!-- 정보 수정 -->
	<select id="selectGeneralMember" parameterType="int" resultMap="generalMemberMap">
		select *
		from mu_member m, mu_general g
		where m.mem_no = g.gen_no
		and m.mem_no=#{memNo}
	</select>
	
	
	<update id="updateMember" parameterType="Member" >
		update mu_member
		set mem_pass=#{memPass}
		where mem_no = #{memNo}
		and mem_name=#{memName}
		and mem_phone=#{memPhone}
	</update>
	
	
	
	<update id="updateGeneralMember" parameterType="GeneralMember" >
		update mu_member
		set birth=#{birth}
		where gen_no = #{genNo}
	</update>
	
	


	<select id="selectCompanyMember" parameterType="int" resultMap="companyMemberMap">
		select *
		from mu_member m, mu_company c
		where m.mem_no = c.com_no
		and m.mem_no=#{memNo}
	</select>
	
	<update id="updateCompanyMember" parameterType="CompanyMember">
		update mu_member
		set com_addr=#{comAddr}
		and com_addr_detail=#{comAddrDetail}
		and com_type=#{comType}
		where gen_no = #{genNo}
	</update>

	
	
	<!-- 나의 역경매 현황보기(개인) -->
	<select id="selectGeneralAuction" parameterType="Auction" resultMap="comInfoMap">
	    select au.*, ci.*
    	from mu_company_info ci
    	right join (select a.auction_type, a.mem_no, a.auction_sdate, a.auction_edate, t.tender_budget, t.tender_regdate
    	from mu_auction a
    	right join mu_tender t
    	on a.auction_no = t.auction_no
    	where a.auction_type=#{auction_type}
    	and t.tender_status='choo'
    	and a.mem_no=#{memNo}) au
    	on au.mem_no = ci.mem_no
	</select>
	
	
	
	
	

	
</mapper>
























