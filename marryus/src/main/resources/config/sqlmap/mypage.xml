<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.marryus.repository.mapper.MypageMapper">
	<resultMap id="comInfoMap" type="CompanyInfo">
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="memNo"   column="mem_no"/>
        <result  property="comInfoContent"   column="com_info_conent"/>
		<result  property="comInfoProfile"   column="com_info_profile"/>
	</resultMap>
	
	

	
	
	<resultMap id="comFileMap" type="CompanyFile">
		<result  property="comFileNo"   column="com_file_no"/>
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="comFileName"   column="com_file_name"/>
		<result  property="comFileOriname"   column="com_file_oriname"/>
		<result  property="comFilePath"   column="com_file_path"/>
	</resultMap>
	
	
	<resultMap id="tenderMap" type="Tender">
		<result property="tenderNo" column="tender_no" />
		<result property="auctionNo" column="action_no" />
		<result property="tenderStatus" column="tender_status" />
		<result property="tenderBudget" column="tender_budget" />
		<result property="tenderRegdate" column="tender_regdate" />
        <result property="genName" column="gen_name" />
	</resultMap>
	
	<resultMap id="auctionMap" type="Auction">
		<result property="auctionNo" column="auction_no" />
		<result property="memNo" column="mem_no" />
		<result property="comNo" column="com_no" />
		<result property="auctionType" column="auction_type" />
		<result property="auctionStatus" column="auction_status" />
		<result property="auctionSdate" column="auction_sdate" />
		<result property="auctionEDate" column="auction_edate" />
		<result property="genName" column="gen_name" />
	</resultMap>
	
	
	
	
	
	<resultMap id="generalMemberMap" type="GeneralMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="memStatus" column="mem_status" />
		<result property="genName" column="gen_name" />
		<result property="genPhone" column="gen_phone" />
		<result property="birth" column="birth" />
		<result property="genName" column="gen_name" />
		<result property="genGender" column="gen_gender" />
	</resultMap>
	
	
	
	<resultMap id="companyMemberMap" type="CompanyMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="comName" column="mem_status" />
		<result property="comAddr" column="gen_name" />
		<result property="comAddrDetail" column="gen_phone" />
		<result property="comPhone" column="birth" />
		<result property="comType" column="gen_name" />
		<result property="comOkay" column="gen_gender" />
	</resultMap>
	
	
	
	<select id="selectTenderList" parameterType="int" resultMap="tenderMap"  >
	select *
	from mu_tender 
	where auction_no=#{auctionNo}

	</select>
	
	
	
	
	
	

	
	

	
	<!-- 업체 정보 등록, 수정, 삭제시 사용 -->
	<insert id="insertComInfo" parameterType="CompanyInfo"  >
	    <selectKey resultType="int" keyProperty="comInfoNo" order="BEFORE">
            SELECT MAX(com_info_no)+1 FROM     mu_company_info 
        </selectKey>    
	
		insert into mu_company_info(mem_no, com_info_content, com_info_profile) 
        values(#{memNo}, #{comInfoContent}, #{comInfoProfile})

	</insert>
	
	<update id="updateComInfo" parameterType="CompanyInfo">
		update mu_comany_info 
        set com_info_content = #{comInfoContent},
		com_info_profile = #{comInfoProfile}
		where com_info_no=#{comInfoNo} 
	</update>
	
	<delete id="deleteComInfo" parameterType="int">
		delete from mu_comany_info 
		where com_info_no=#{comInfoNo}
	</delete>
	
	<!-- 업체 정보  파일 등록, 수정, 삭제시 사용 -->
	<insert id="insertComFile" parameterType="CompanyFile">
		insert into mu_company_file(com_info_no, com_file_name, com_file_oriname, com_file_path)
		values(#{comInfoNo}, #{comFileName}, #{comFileOriname}, #{comFilePath})
	</insert>
	
	<update id="updateComFile" parameterType="CompanyFile">
		update mu_comany_file
		set com_info_no=#{comInfoNo},
		com_file_name=#{comFileName},
		com_file_path=#{comFilePath}
		where com_info_no=#{comInfoNo}
	</update>
	
	<delete id="deleteComFile" parameterType="int">
		delete from mu_comany_file 
		where com_info_no=#{comInfoNo}
	</delete>
	
	
	<!-- 관리자 경매리스트 -->

    <select id="selectAuction"  parameterType="Page" resultMap="tenderMap">
        SELECT tender_regdate, gen_name, tender_status, tender_budget 
        FROM (select * 
        from mu_auction a, mu_general g
        where a.mem_no = g.gen_no) as aa
        RIGHT JOIN mu_tender t
        ON aa.auction_no = t.auction_no
        and  aa.com_no=#{comNo}
        limit #{begin}, 10

	</select>




	
	
    <select id="selectAuctionCnt" parameterType="int" resultType="int">
		select count(*) as count
        from(select t.tender_no 
        from mu_auction a, mu_tender t
        where a.auction_no = t.auction_no
        and com_no=#{comNo}) a
	</select>
	
	
	
	
	<!-- 일반회원 정보 수정 -->
	<select id="selectGeneralMember" parameterType="int" resultMap="generalMemberMap">
		select *
		from mu_member m, mu_general g
		where m.mem_no = g.gen_no
		and m.mem_no=#{memNo}
	</select>
	
	
	<!-- 기업회원 정보 수정 -->
	<select id="selectCompanyMember" parameterType="int" resultMap="companyMemberMap">
		select *
		from mu_member m, mu_company c
		where m.mem_no = c.com_no
		and m.mem_no=#{memNo}
	</select>
	
	
	
	
	

	
</mapper>
























