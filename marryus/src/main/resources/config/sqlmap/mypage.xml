<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.marryus.repository.mapper.MypageMapper">
	<resultMap id="comInfoMap" type="CompanyInfo">
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="memNo"   column="mem_no"/>
        <result  property="comInfoContent"   column="com_info_content"/>
		<result  property="comInfoProfile"   column="com_info_profile"/>
		<result  property="comInfoName"   column="com_info_name"/>
		<result  property="comInfoPhone"   column="com_info_phone"/>
		<result  property="comInfoAddr"   column="com_info_addr"/>
		<result  property="comInfoAddrDetail"   column="com_info_addr_detail"/>
		<result  property="comInfoType"   column="com_info_type"/>
		<result  property="comInfoOkay"   column="com_info_okay"/>
		<result  property="comFileName"   column="com_file_name"/>
		<result  property="comFilePath"   column="com_file_path"/>
		
		<result  property="aucionType"   column="aucion_type"/>
		<result  property="auctionSdate"   column="auction_sdate"/>
		<result  property="auctionEdate"   column="auction_edate"/>
		<result  property="tenderBudget"   column="tender_budget"/>
		<result  property="tenderRegdate"   column="tender_regdate"/>
	</resultMap>
	

	
	
	<resultMap id="comFileMap" type="CompanyFile">
		<result  property="comFileNo"   column="com_file_no"/>
		<result  property="comInfoNo"   column="com_info_no"/>
		<result  property="comFileName"   column="com_file_name"/>
		<result  property="comFileOriname"   column="com_file_oriname"/>
		<result  property="comFilePath"   column="com_file_path"/>
		<result  property="comFileRepr"   column="com_file_repr"/>
	</resultMap>
	
	
	<resultMap id="tenderMap" type="Tender">
		<result property="tenderNo" column="tender_no" />
		<result property="auctionNo" column="action_no" />
		<result property="tenderStatus" column="tender_status" />
		<result property="tenderBudget" column="tender_budget" />
		<result property="tenderRegdate" column="tender_regdate" />
        <result property="memName" column="mem_name" />
        <result property="memNo" column="mem_no" />
	</resultMap>
	
	<resultMap id="auctionMap" type="Auction">
		<result property="auctionNo" column="auction_no" />
		<result property="memNo" column="mem_no" />
		<result property="comNo" column="com_no" />
		<result property="auctionType" column="auction_type" />
		<result property="auctionStatus" column="auction_status" />
		<result property="auctionSdate" column="auction_sdate" />
		<result property="auctionEDate" column="auction_edate" />
		<result property="memName" column="mem_name" />
	</resultMap>
	
	
	
	
	
	<resultMap id="generalMemberMap" type="GeneralMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="memStatus" column="mem_status" />
		<result property="memName" column="mem_name" />
		<result property="memPhone" column="mem_phone" />
		<result property="genBirth" column="gen_birth" />
		<result property="genGender" column="gen_gender" />
		<result property="genNo" column="gen_no" />
		<result property="genProfilepath" column="gen_profilepath" />
		<result property="genProfilename" column="gen_profilename" />
	</resultMap>
	
	
	
	<resultMap id="companyMemberMap" type="CompanyMember">
		<result property="memNo" column="mem_no" />
		<result property="memEmail" column="mem_email" />
		<result property="memPass" column="mem_pass" />
		<result property="memType" column="mem_type" />
		<result property="memName" column="mem_name" />
		<result property="comAddr" column="com_addr" />
		<result property="comAddrDetail" column="com_addr_detail" />
		<result property="memPhone" column="mem_phone" />
		<result property="comType" column="com_type" />
		<result property="comOkay" column="com_okay" />
		<result property="comNo" column="com_no" />
	</resultMap>
	
	
	<resultMap id="companyLikeMap" type="CompanyLike">
		<result property="memNo" column="mem_no" />
		<result property="comInfoNo" column="com_info_no" />
	</resultMap>
	
	
	
	<resultMap id="venueMap" type="Venue">
		<result property="auctionNo" column="auction_no" />
		<result property="weddingVenue" column="wedding_venue" />
		<result property="weddingDate" column="wedding_date" />
		<result property="weddingTime" column="wedding_time" />
		<result property="weddingType" column="wedding_type" />
		<result property="weddingVistor" column="wedding_vistor" />
		<result property="weddingWish" column="wedding_wish" />
		<result property="weddingBudget" column="wedding_budget" />
	</resultMap>
	
	<resultMap id="studioMap" type="Studio">
		<result property="auctionNo" column="auction_no" />
		<result property="studioPlace" column="studio_place" />
		<result property="studioOutdoor" column="studio_outdoor" />
		<result property="studioSnapshot" column="studio_snapshot" />
		<result property="studioVideo" column="studio_video" />
		<result property="studioPickup" column="studio_pickup" />
	</resultMap>
	
	<resultMap id="dressMap" type="Dress">
		<result property="auctionNo" column="auction_no" />
		<result property="dressPrice" column="dress_price" />
		<result property="dressNeckline" column="dress_neckline" />
		<result property="dressType" column="dress_type" />
	</resultMap>
	
	<resultMap id="makeupMap" type="Makeup">
		<result property="auctionNo" column="auction_no" />
		<result property="mkuMakeup" column="mku_makeup" />
		<result property="mkuMom" column="mku_mom" />
		<result property="mkuBudget" column="mku_budget" />
		<result property="mkuWorkout" column="mku_workout" />
		<result property="mkuMore" column="mku_more" />
	</resultMap>
	
	<resultMap id="honeymoonMap" type="Honeymoon">
		<result property="auctionNo" column="auction_no" />
		<result property="honeyPlace" column="honey_place" />
		<result property="honeyDate" column="honey_date" />
		<result property="honeyHope" column="honey_hope" />
	</resultMap>
	
	<resultMap id="jewelryMap" type="Jewelry">
		<result property="auctionNo" column="auction_no" />
		<result property="gift" column="gift" />
		<result property="giftPrice" column="gift_price" />
		<result property="giftHope" column="gift_hope" />
	</resultMap>
	
	<resultMap id="serviceAddMap" type="ServiceAdd">
		<result property="auctionNo" column="auction_no" />
		<result property="serviceType" column="service_type" />
		<result property="serviceDetail" column="service_detail" />
	</resultMap>
	
	
	
	<resultMap id="serviceAddMap" type="ServiceAdd">
		<result property="auctionNo" column="auction_no" />
		<result property="serviceType" column="service_type" />
		<result property="serviceDetail" column="service_detail" />
	</resultMap>
	
	
	<resultMap id="todoMap" type="Todo">
		<result property="todoSchedule" column="todo_schedule" />
		<result property="todoContent" column="todo_content" />
		<result property="todoDday" column="todo-dday" />
		<result property="todoCategory" column="todo_category" />
		<result property="todoNo" column="todo_no" />
		<result property="todoCheck" column="todo_check" />
		<result property="todoDelete" column="todo_delete" />
	</resultMap>
	
	
	
	

	
	

	
	
	

	
	
	
	
	
	
	
	
	
	<select id="selectTenderList" parameterType="int" resultMap="tenderMap"  >
	select *
	from mu_tender 
	where auction_no=#{auctionNo}

	</select>
	
	


	
	

	
	<!-- 업체 정보 등록, 수정, 삭제시 사용 -->
	<select id="selectComInfoList"  parameterType="int" resultMap="comInfoMap">
		select *
		from mu_company_info ci right join mu_company_file cf
        on ci.com_info_no = cf.com_info_no
        where ci.mem_no=#{memNo}
        and cf.com_file_repr = 'Y'
        and com_info_type in('v','s','d','m','h','j','e')
        order by field(com_info_type,'v','s','d','m','h','j','e')
	</select>
										
	
	
	<select id="selectComInfoDetail" parameterType="CompanyInfo" resultMap="comInfoMap">
		select *
		from mu_company_info
        where com_info_no=#{comInfoNo}
        and mem_no=#{memNo}
	</select>
	
	
	<insert id="insertComInfo" parameterType="CompanyInfo"  >
	    <selectKey resultType="int" keyProperty="comInfoNo" order="BEFORE">
            SELECT MAX(com_info_no)+1 FROM     mu_company_info 
        </selectKey>    
	
		insert into mu_company_info(mem_no, com_info_content, com_info_profile, com_info_name, com_info_phone,com_info_addr, com_info_addr_detail, com_info_type) 
        values(#{memNo}, #{comInfoContent}, #{comInfoProfile}, #{comInfoName}, #{comInfoPhone},#{comInfoAddr}, #{comInfoAddrDetail}, #{comInfoType})

	</insert>
	
	<update id="updateComInfo" parameterType="CompanyInfo">
		update mu_company_info 
        set com_info_content = #{comInfoContent},
		com_info_profile = #{comInfoProfile},
		com_info_name=#{comInfoName},
		com_info_phone=#{comInfoPhone},
		com_info_addr=#{comInfoAddr},
		com_info_addr_detail=#{comInfoAddrDetail},
		com_info_type=#{comInfoType},
		com_info_okay=#{comInfoOkay}
		where com_info_no=#{comInfoNo} 
	</update>
	
	<delete id="deleteComInfo" parameterType="int">
		delete from mu_company_info 
		where com_info_no=#{comInfoNo}
	</delete>
	
	<!-- 업체 정보  파일 등록, 수정, 삭제시 사용 -->
	
	
	<select id="selectComFiles" parameterType="CompanyInfo" resultMap="comFileMap">
		select *
		from mu_company_file cf, mu_company_info ci
		where ci.com_info_no=cf.com_info_no
        and com_file_repr='N'
        and ci.mem_no=#{memNo}
        and ci.com_info_no=#{comInfoNo}
	</select>
	
	
	<select id="selectComFile" parameterType="CompanyInfo" resultMap="comFileMap">
		select *
		from mu_company_file cf, mu_company_info ci
		where ci.com_info_no=cf.com_info_no
        and com_file_repr='Y'
        and ci.mem_no=#{memNo}
        and ci.com_info_no=#{comInfoNo}
	</select>
	
	
	<insert id="insertComFile" parameterType="CompanyFile">
		insert into mu_company_file(com_info_no, com_file_name, com_file_oriname, com_file_path, com_file_repr)
		values(#{comInfoNo}, #{comFileName}, #{comFileOriname}, #{comFilePath}, #{comFileRepr})
	</insert>
	
	
	<delete id="deleteComFile" parameterType="int">
		delete from mu_company_file 
		where com_file_no=#{comFileNo}
	</delete>
	
	
	<!-- 관리자 경매리스트 -->

    <select id="selectAuction"  parameterType="Page" resultMap="tenderMap">
               select *
        from mu_member m
        inner join mu_auction a
        on a.mem_no = m.mem_no
        inner join mu_tender t
        ON a.auction_no = t.auction_no
        where t.mem_no=#{memNo}
        limit #{begin}, 10
	</select>




	
	
    <select id="selectAuctionCnt" parameterType="int" resultType="int">
		select count(*) as count
        from(select t.tender_no 
        from mu_auction a, mu_tender t
        where a.auction_no = t.auction_no
        and t.mem_no=#{memNo}) a
	</select>
	
	
	
	
	<!-- 정보 수정 -->
	<select id="selectGeneralMember" parameterType="int" resultMap="generalMemberMap">
		select *
		from mu_member m, mu_general g
		where m.mem_no = g.gen_no
		and m.mem_no=#{memNo}
	</select>
	
	<select id="selectCompanyMember" parameterType="int" resultMap="companyMemberMap">
		select *
		from mu_member m, mu_company c
		where m.mem_no = c.com_no
		and m.mem_no=#{memNo}
	</select>
	
	
	<update id="updateMember" parameterType="Member" >
		update mu_member
		set mem_pass=#{pass},
		mem_name=#{name},
		mem_phone=#{phone}
		where mem_no = #{no}
	</update>
	
	<update id="updateGeneralMember" parameterType="GeneralMember" >
		update mu_general
		set gen_birth=#{genBirth},
		gen_profilepath=#{genProfilepath},
		gen_profilename=#{genProfilename}
		where gen_no = #{genNo}
	</update>
	

	
	<update id="updateCompanyMember" parameterType="CompanyMember">
		update mu_company
		set com_addr=#{comAddr},
		com_addr_detail=#{comAddrDetail},
		com_type=#{comType}
		where com_no = #{comNo}
	</update>
	
	



	

	
	
	<!-- 나의 역경매 현황보기(개인) -->
	<select id="selectGeneralAuction" parameterType="Auction" resultMap="comInfoMap">
		select *
		from mu_auction a 
		left join mu_tender t
		on a.auction_no = t.auction_no
		inner join mu_company_info ci
		on t.com_info_no = ci.com_info_no
        inner join mu_company_file cf
        on ci.com_info_no = cf.com_info_no
		where a.mem_no=#{memNo}
		and a.auction_type=#{auctionType}
		and a.auction_status='ing'
	</select>
	
	
	<select id="selectGeneralAuctionCnt" parameterType="Auction" resultType="int">
		select count(*)
		from mu_auction a 
		left join mu_tender t
		on a.auction_no = t.auction_no
        group by a.auction_type
        having a.mem_no=#{memNo}
		and a.auction_type=#{auctionType}
		and a.auction_status='ing' 
	</select>
	
	
	
	
	
	
	<!-- 나의 관심업체 보기 -->
	<select id="selectCompanyLike" parameterType="int" resultMap="comInfoMap">
		select *
		from mu_company_like l
		inner join mu_company_info ci
		on l.com_info_no = ci.com_info_no
        inner join mu_company_file cf
        on ci.com_info_no = cf.com_info_no
		where l.mem_no=#{memNo}
        and cf.com_file_repr='Y'
	</select>
	
	<delete id="deleteCompanyLike" parameterType="CompanyLike" >
		delete from mu_company_like
		where mem_no=#{memNo}
		and com_info_no=#{comInfoNo}
	</delete>
	
	<select id="selectCompanyLikeCnt" parameterType="int" resultType="int">
		select count(*)
		from mu_company_like l
		inner join mu_company_info ci
		on l.com_info_no = ci.com_info_no
		where l.mem_no=#{memNo};
	</select>
	

	
	
	<!-- 입찰 내역 보기 -->
	<select id="selectTenders" parameterType="Auction" resultMap="tenderMap">
		select *
		from mu_auction a
		inner join mu_tender t
		on t.auction_no = a.auction_no 
		inner join mu_company_info ci
		on t.com_info_no = ci.com_info_no
		where a.mem_no=#{memNo}
		and a.auction_status=#{auctionStatus}
	</select>
	
	
	<select id="selectAuctions" parameterType="Auction" resultMap="venueMap">
		select v.*
		from mu_venue v
		inner join mu_auction a
		on v.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	
	<select id="selectVenue" parameterType="Auction" resultMap="venueMap">
		select v.*
		from mu_venue v
		inner join mu_auction a
		on v.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	
	<select id="selectStudio" parameterType="Auction" resultMap="studioMap">
		select s.*
		from mu_studio s
		inner join mu_auction a
		on s.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	
	
	<!-- 역경매 신청서 수정 -->
	<select id="selectDress" parameterType="Auction" resultMap="dressMap">
		select d.*
		from mu_dress d
		inner join mu_auction a
		on d.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	<select id="selectMakeup" parameterType="Auction" resultMap="makeupMap">
		select m.*
		from mu_makeup m
		inner join mu_auction a
		on m.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	<select id="selectHoneymoon" parameterType="Auction" resultMap="honeymoonMap">
		select m.*
		from mu_honeymoon m
		inner join mu_auction a
		on m.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
	
	<select id="selectJewelry" parameterType="Auction" resultMap="jewelryMap">
		select j.*
		from mu_jewelry j
		inner join mu_auction a
		on j.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select>
	
 	<select id="selectServiceAdd" parameterType="Auction" resultMap="serviceAddMap">
		select sd.*
		from mu_serviceadd sd
		inner join mu_auction a
		on sd.auction_no=a.auction_no 
		where  a.auction_status=#{auctionStatus}
		and a.mem_no=#{memNo}
	</select> 
	
	
	<update id="updateVenue" parameterType="Venue" >
		update mu_vennu
		set wedding_venue=#{weddingVenue},
		wedding_date=#{weddingDate},
		wedding_time=#{weddingTime},
		wedding_type=#{weddingType},
		wedding_vistor=#{weddingVistor},
		wedding_wish=#{weddingWish},
		wedding_budget=#{weddingBudget}
		where auction_no=#{auctionNo}
	</update>
	
	
	<update id="updateStudio" parameterType="Studio" >
		update mu_studio
		set studio_place=#{studioPlace},
		studio_outdoor=#{studioOutdoor},
		studio_snapshot=#{studioSnapshot},
		studio_video=#{studioVideo},
		studio_pickup=#{studioPickup}
		where auction_no=#{auctionNo}
	</update>
	
	
	<update id="updateDress" parameterType="Dress" >
		update mu_dress
		set dress_price=#{dressPrice},
		dress_neckline=#{dressNeckline},
		dress_type=#{dressType}
		where auction_no=#{auctionNo}
	</update>
	
	<update id="updateMakeup" parameterType="Makeup" >
		update mu_makeup
		set mku_makeup=#{mkuMakeup},
		dress_neckline=#{mkuMom},
		dress_type=#{mkuBudget},
		dress_neckline=#{mkuWorkout},
		dress_type=#{mkuMore}
		where auction_no=#{auctionNo}
	</update>
	
	<update id="updateJewelry" parameterType="Jewelry" >
		update mu_makeup
		set gift=#{gift},
		gift_price=#{giftPrice},
		gift_hope=#{giftHope}
		where auction_no=#{auctionNo}
	</update>
	
	
	<update id="updateServiceAdd" parameterType="ServiceAdd" >
		update mu_makeup
		set service_type=#{serviceType},
		service_detail=#{serviceDetail}
		where auction_no=#{auctionNo}
	</update>
	
	
	<!-- 웨딩 체크리스트 -->
	<select id="selectTodo" parameterType="int" resultMap="todoMap">
		select *
		from mu_todo
		where mem_no=#{memNo}
	</select>
	
	<insert id="insertTodo" parameterType="Todo" >
		insert into mu_todo(todo_schedule, todo_content, todo_dday, todo_category, mem_no) 
		values(#{todoSchedule},#{todoContent},#{todoDday},#{todoCategory},#{memNo})
	</insert>
	
	<update id="updateTodo" parameterType="Todo">
		update mu_todo 
		set todo_schedule=#{todoSchedule},
		todo_content=#{todoContent},
		todo_dday=#{todoDday},
		todo_category=#{todoCategory},
		todo_check=#{todoCheck},
    	todo_delete=#{todoDelete}
		where mem_no=#{memNo}
	</update>
	
	

	
</mapper>
























