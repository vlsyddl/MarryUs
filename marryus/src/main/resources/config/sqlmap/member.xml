<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.marryus.repository.mapper.MemberMapper">
	<resultMap id="memberMap" type="Member">
		<result column="mem_no" property="no" />
		<result column="mem_email" property="email" />
		<result column="mem_pass" property="pass" />
		<result column="mem_type" property="type" />
		<result column="mem_status" property="status" />
		<result column="mem_name" property="name" />
		<result column="mem_phone" property="phone" />
		<collection property="general" resultMap="generalMap" />
		<collection property="company" resultMap="companyMap"/>
	</resultMap>
	<resultMap id="generalMap" type="General">
		<result column="gen_no" property="genNo" />
		<result column="gen_birth" property="genBirth" />
		<result column="gen_gender" property="genGender" />
	</resultMap>
	<resultMap id="companyMap" type="Company">
		<result column="com_no" property="comNo" />
		<result column="com_addr" property="comAddr" />
		<result column="com_addr_detail" property="comAddrDetail" />
		<result column="com_type" property="comType" />
	</resultMap>
	<resultMap id="todoMap" type="Todo">
		<result property="todoPeriod" column="todo_period" />
		<result property="todoTitle" column="todo_title" />
		<result property="memNo" column="mem_no" />
		<result property="todoDday" column="todo_dday" />
		<result property="todoDay" column="todo_day" />
		<result property="todoCategory" column="todo_category" />
		<result property="todoNo" column="todo_no" />
		<result property="todoCheck" column="todo_check" />
		<result property="todoDelete" column="todo_delete" />
		<result property="todoDetail" column="todo_detail" />
		<collection property="weddingPlan" resultMap="weddingPlanMap" />
	</resultMap>
	
	<!-- 로그인-->
	
	<!-- Member -->
	<select id="login" parameterType="Member" resultMap="memberMap" >
		select *
		  from mu_member
		 where mem_email = #{email}
	</select>
	<select id="loginGeneral" parameterType="Member" resultMap="memberMap">
		select * 
		  from mu_member 
		 inner join mu_general
		    on mem_no = gen_no 
		 where mem_email = #{email}
	</select>
	<select id="loginCompany" parameterType="Member" resultMap="memberMap">
		select * 
		  from mu_member 
		 inner join mu_company
		    on mem_no = com_no 
		 where mem_email = #{email}
	</select>
	
	<!-- 회원가입 -->
	
	<!-- 1.Member table -->
	<insert id="insertMember" parameterType="Member"  useGeneratedKeys="true" keyProperty="no">
		insert into mu_member 
		( mem_email, mem_pass, mem_type , mem_name, mem_phone)
		values
		( #{email}, #{pass}, #{type}, #{name}, #{phone} )
	</insert>
	
	<!-- 2.일반회원 -->
	<insert id="insertGeneral" parameterType="General" >
		insert into mu_general 
		( gen_no, gen_birth, gen_gender )
		values
		( #{genNo}, #{genBirth} , #{genGender} )
	</insert>
	
	<!-- 3.기업회원 -->
	<insert id="insertCompany" parameterType="Company">
		insert into mu_company
		( com_no, com_addr, com_addr_detail, com_type )
		values
		( #{comNo}, #{comAddr}, #{comAddrDetail}, #{comType} )
	</insert>
	
	<!-- 이메일 중복체크 -->
	<select id="checkID" parameterType="String" resultType="int">
		select count(*) from mu_member
		where mem_email = #{email}
	</select>
	
	<!-- 비밀번호 찾기  -->
	<!-- 아이디 이름 매치  -->
	<select id="findId" parameterType="Member" resultType="int" >
		select count(*)
		  from mu_member
		 where mem_email = #{email}
		   and mem_name = #{name} 
	</select>
	<!-- 새비밀번호 변경하기  -->
	<update id="updateNewPass" parameterType="Member" >
		 update mu_member 
	    	set mem_pass = #{pass}
		  where mem_email= #{email}
	</update>
	
	<!-- todoList생성 -->
	<insert id="insertCopyTable" parameterType="int" >
		insert into mu_todo(select todo_period,todo_title, todo_dday,todo_category,null,#{memNo},null,null, 'N', 'N' from mu_todolist);  
	</insert>
</mapper>

























